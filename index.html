<!DOCTYPE html>
<html lang="as">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assamese AI Brain Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #f4f7f6;
            --chat-bg: #ffffff;
            --primary-color: #10a37f;
            --text-color: #333;
            --bot-msg-bg: #f7f7f8;
            --user-msg-bg: #e3f2fd;
            --border-color: #e5e5e5;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-color); display: flex; justify-content: center; height: 100vh; }
        .chat-container { width: 100%; max-width: 800px; background: var(--chat-bg); display: flex; flex-direction: column; height: 100%; box-shadow: 0 0 15px rgba(0,0,0,0.05); position: relative; }
        .header { background-color: var(--chat-bg); padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; }
        .header h2 { font-size: 1.2rem; color: #202123; display: flex; align-items: center; gap: 10px; }
        .header h2 i { color: var(--primary-color); }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .delete-btn { color: #dc3545; cursor: pointer; font-size: 1.2rem; transition: 0.2s; }
        .delete-btn:hover { color: #a71d2a; }
        .token-count { font-size: 0.9rem; background: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 15px; font-weight: bold; }
        .chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .message { display: flex; gap: 15px; max-width: 85%; }
        .message.user { align-self: flex-end; flex-direction: row-reverse; }
        .avatar { width: 35px; height: 35px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0; }
        .bot-avatar { background-color: var(--primary-color); color: white; }
        .user-avatar { background-color: #007bff; color: white; }
        .msg-text { padding: 12px 16px; border-radius: 8px; line-height: 1.5; font-size: 1rem; width: 100%; overflow-x: auto; }
        .bot .msg-text { background-color: var(--bot-msg-bg); border: 1px solid var(--border-color); color: #333; }
        .user .msg-text { background-color: var(--user-msg-bg); color: #004085; }
        
        /* Markdown ‡¶Ü‡ß∞‡ßÅ Code Box ‡ß∞ ‡¶™‡ßá‡¶õ‡¶æ‡¶¶‡¶æ‡ß∞‡ßÄ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        .markdown-body pre {
            background-color: #282c34;
            color: #abb2bf;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
            font-size: 0.9rem;
        }
        .markdown-body code {
            font-family: 'Courier New', Courier, monospace;
            background-color: rgba(0,0,0,0.05);
            padding: 2px 5px;
            border-radius: 4px;
            color: #d14;
        }
        .markdown-body pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }
        .markdown-body p { margin-bottom: 8px; }
        .markdown-body ul, .markdown-body ol { margin-left: 25px; margin-bottom: 10px; }
        .markdown-body strong { color: #111; }

        .input-area { padding: 20px; background: var(--chat-bg); border-top: 1px solid var(--border-color); display: flex; gap: 10px; flex-direction: column; }
        .input-wrapper { display: flex; gap: 10px; background: white; border: 1px solid var(--border-color); padding: 5px 10px; border-radius: 25px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
        input { flex: 1; border: none; padding: 10px; outline: none; font-size: 1rem; background: transparent; }
        button { background-color: var(--primary-color); color: white; border: none; padding: 10px 18px; border-radius: 20px; cursor: pointer; font-size: 1rem; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        button:hover { background-color: #0d8c6d; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        .recharge-btn { background-color: #ffc107; color: #000; width: 100%; display: none; margin-bottom: 10px; font-weight: bold; }
        .recharge-btn:hover { background-color: #e0a800; }
        .typing { display: none; align-items: center; gap: 5px; padding: 10px; color: #666; font-style: italic; font-size: 0.9rem;}
        .dot { width: 6px; height: 6px; background: #666; border-radius: 50%; animation: blink 1.4s infinite both; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0%, 80%, 100% { opacity: 0; } 40% { opacity: 1; } }

        /* Modal Design */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 99999; justify-content: center; align-items: center; flex-direction: column; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; text-align: center; width: 90%; max-width: 350px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .timer-text { color: red; font-weight: bold; margin: 10px 0 15px 0; font-size: 1.1rem; }
        .claim-btn { width: 100%; margin-top: 20px; padding: 12px; border-radius: 8px; font-weight: bold; }

        /* Info Modal Design for About Us, Contact etc. */
        .info-modal-content { background: white; padding: 25px; border-radius: 10px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; text-align: left; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .info-modal-content h3 { color: var(--primary-color); margin-bottom: 15px; border-bottom: 2px solid var(--border-color); padding-bottom: 5px; }
        .info-modal-content p { margin-bottom: 10px; line-height: 1.6; font-size: 0.95rem; }
        .close-info-btn { background-color: #dc3545; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; float: right; margin-top: 15px; }
        .close-info-btn:hover { background-color: #c82333; }

        /* Footer Design */
        .footer { background-color: var(--chat-bg); padding: 10px; text-align: center; border-top: 1px solid var(--border-color); font-size: 0.85rem; }
        .footer a { color: var(--primary-color); text-decoration: none; margin: 0 8px; cursor: pointer; }
        .footer a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div id="adModal" class="modal-overlay">
    <div class="modal-content">
        <h3 style="color: #333;">üéÅ ‡¶ï‡ßç‡ß∞‡¶ø‡¶™‡ßç‡¶ü‡ßã ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</h3>
        <p id="adTimer" class="timer-text">‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡ß∞‡¶π ‡¶ï‡ß∞‡¶ø ‡ßß‡ß¶ ‡¶õ‡ßá‡¶ï‡ßá‡¶£‡ßç‡¶° ‡ß∞‡ßà ‡¶¶‡¶ø‡¶Ø‡¶º‡¶ï...</p>
        
        <div id="frame" style="width: 100%; margin: auto; position: relative; z-index: 99998; min-height: 100px; background: #f0f0f0; border: 1px solid #ccc;">
            <iframe data-aa='2428261' src='//acceptable.a-ads.com/2428261/?size=Adaptive' style='border:0; padding:0; width:100%; height:100%; overflow:hidden; display:block; margin:auto'></iframe>
        </div>
        
        <button id="closeAdBtn" class="claim-btn" disabled>‡ß∞‡ßà ‡¶¶‡¶ø‡¶Ø‡¶º‡¶ï...</button>
    </div>
</div>

<div id="infoModal" class="modal-overlay">
    <div class="info-modal-content">
        <h3 id="infoTitle">Title</h3>
        <div id="infoBody">Content goes here...</div>
        <button class="close-info-btn" onclick="closeInfoModal()">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡ß∞‡¶ï</button>
    </div>
</div>

<div class="chat-container">
    <div class="header">
        <h2><i class="fas fa-robot"></i> Assamese AI Brain</h2>
        <div class="header-right">
            <i class="fas fa-trash-alt delete-btn" onclick="clearChatHistory()" title="‡¶™‡ßÅ‡ß∞‡¶£‡¶ø ‡¶ï‡¶•‡¶æ-‡¶¨‡¶§‡ß∞‡¶æ ‡¶Æ‡¶ö‡¶ø ‡¶™‡ßá‡¶≤‡¶æ‡¶ì‡¶ï"></i>
            <div class="token-count" id="tokenDisplay">Tokens: 50</div>
        </div>
    </div>
    
    <div class="chat-box" id="chatBox">
        <div class="message bot" id="defaultGreeting">
            <div class="avatar bot-avatar"><i class="fas fa-robot"></i></div>
            <div class="msg-text">‡¶®‡¶Æ‡¶∏‡ßç‡¶ï‡¶æ‡ß∞! ‡¶Æ‡¶á ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡ß∞ Advanced AI Assistant. ‡¶Æ‡¶á ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡¶ï ‡¶ï‡ßá‡¶®‡ßá‡¶ï‡ßà ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º ‡¶ï‡ß∞‡¶ø‡¶¨ ‡¶™‡¶æ‡ß∞‡ßã‡¶Å?</div>
        </div>
    </div>

    <div class="typing" id="typingIndicator">
        AI-‡¶Ø‡¶º‡ßá ‡¶≠‡¶æ‡¶¨‡¶ø ‡¶Ü‡¶õ‡ßá <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>

    <div class="input-area">
        <button class="recharge-btn" id="rechargeBtn" onclick="rechargeTokens()"><i class="fas fa-video"></i> ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶æ‡¶ì‡¶ï (Recharge 500 Coins)</button>
        <div class="input-wrapper">
            <input type="text" id="userInput" placeholder="‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡ß∞ ‡¶™‡ßç‡ß∞‡¶∂‡ßç‡¶® ‡¶á‡¶Ø‡¶º‡¶æ‡¶§ ‡¶≤‡¶ø‡¶ñ‡¶ï..." onkeypress="handleKeyPress(event)">
            <button id="sendBtn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="footer">
        <a onclick="showPage('about')">About Us</a> |
        <a onclick="showPage('contact')">Contact</a> |
        <a onclick="showPage('privacy')">Privacy Policy</a> |
        <a onclick="showPage('terms')">Terms & Conditions</a>
    </div>
</div>

<script>
    // --- User ID ‡¶Ü‡ß∞‡ßÅ Chat History ‡¶≤‡¶ú‡¶ø‡¶ï ---
    let userId = localStorage.getItem('assamese_ai_user_id');
    if (!userId) {
        userId = "user_" + Math.floor(Math.random() * 1000000);
        localStorage.setItem('assamese_ai_user_id', userId);
    }

    window.onload = function() {
        const savedHistory = localStorage.getItem('assamese_ai_chat_history');
        if (savedHistory) {
            document.getElementById('chatBox').innerHTML = savedHistory;
            const chatBox = document.getElementById('chatBox');
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    };

    function saveChatHistory() {
        const chatBoxHTML = document.getElementById('chatBox').innerHTML;
        localStorage.setItem('assamese_ai_chat_history', chatBoxHTML);
    }

    function clearChatHistory() {
        if (confirm("‡¶Ü‡¶™‡ßÅ‡¶®‡¶ø ‡¶∏‡¶ï‡¶≤‡ßã ‡¶™‡ßÅ‡ß∞‡¶£‡¶ø ‡¶ï‡¶•‡¶æ-‡¶¨‡¶§‡ß∞‡¶æ ‡¶Æ‡¶ö‡¶ø ‡¶™‡ßá‡¶≤‡¶æ‡¶¨‡¶≤‡ßà ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶®‡ßá?")) {
            localStorage.removeItem('assamese_ai_chat_history');
            location.reload(); 
        }
    }
    // --- End of History Logic ---

    // --- Info Pages Data ---
    const pagesData = {
        'about': { title: 'About Us', body: '<p><strong>Assamese AI Brain Pro</strong> ‡¶≤‡ßà ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡¶ï ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ‡•§</p><p>‡¶Ü‡¶Æ‡¶æ‡ß∞ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø ‡¶π‡ßà‡¶õ‡ßá ‡¶Ö‡¶∏‡¶Æ‡ßÄ‡¶Ø‡¶º‡¶æ ‡¶≠‡¶æ‡¶∑‡¶æ‡¶§ ‡¶è‡¶ñ‡¶® ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶Ü‡ß∞‡ßÅ ‡¶∏‡¶π‡¶ú‡ßá ‡¶¨‡ßç‡¶Ø‡ß±‡¶π‡¶æ‡ß∞ ‡¶ï‡ß∞‡¶ø‡¶¨ ‡¶™‡ß∞‡¶æ ‡¶ï‡ßÉ‡¶§‡ßç‡ß∞‡¶ø‡¶Æ ‡¶¨‡ßÅ‡¶¶‡ßç‡¶ß‡¶ø‡¶Æ‡¶§‡ßç‡¶§‡¶æ (AI) ‡¶™‡ßç‡¶≤‡ßá‡¶ü‡¶´‡ß∞‡ßç‡¶Æ ‡¶ó‡¶¢‡¶º‡¶ø ‡¶§‡ßã‡¶≤‡¶æ‡•§</p>' },
        'contact': { title: 'Contact Us', body: '<p>‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡ß∞ ‡¶Æ‡¶§‡¶æ‡¶Æ‡¶§ ‡¶Ü‡ß∞‡ßÅ ‡¶™‡ß∞‡¶æ‡¶Æ‡ß∞‡ßç‡¶∂ ‡¶∏‡¶¶‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶¶‡ß∞‡¶£‡¶ø ‡¶ú‡¶®‡¶æ‡¶ì‡¶Å‡•§</p><ul><li><strong>‡¶†‡¶ø‡¶ï‡¶®‡¶æ:</strong> ‡¶Ø‡ßã‡ß∞‡¶π‡¶æ‡¶ü, ‡¶Ö‡¶∏‡¶Æ, ‡¶≠‡¶æ‡ß∞‡¶§</li><li><strong>‡¶á‡¶Æ‡ßá‡¶á‡¶≤:</strong> contact@assamese-ai-brain.onrender.com</li></ul>' },
        'privacy': { title: 'Privacy Policy', body: '<p>‡¶Ü‡¶Æ‡¶æ‡ß∞ ‡ß±‡ßá‡¶¨‡¶õ‡¶æ‡¶á‡¶ü ‡¶¨‡ßç‡¶Ø‡ß±‡¶π‡¶æ‡ß∞ ‡¶ï‡ß∞‡¶æ‡ß∞ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶§ ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡ß∞ ‡¶ó‡ßã‡¶™‡¶®‡ßÄ‡¶Ø‡¶º‡¶§‡¶æ ‡ß∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡ß∞‡¶æ‡¶ü‡ßã ‡¶Ü‡¶Æ‡¶æ‡ß∞ ‡¶™‡ßç‡ß∞‡¶ß‡¶æ‡¶® ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡ß∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶ó‡ßç‡ß∞‡¶π ‡¶®‡¶ï‡ß∞‡ßã‡¶Å‡•§</p>' },
        'terms': { title: 'Terms & Conditions', body: '<p>‡¶è‡¶á AI ‡¶ü‡ßÅ‡¶≤‡¶ü‡ßã ‡¶ï‡ßá‡ß±‡¶≤ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï ‡¶Ü‡ß∞‡ßÅ ‡¶§‡¶•‡ßç‡¶Ø‡¶Æ‡ßÇ‡¶≤‡¶ï ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø‡ß∞ ‡¶¨‡¶æ‡¶¨‡ßá ‡¶¶‡¶ø‡¶Ø‡¶º‡¶æ ‡¶π‡ßà‡¶õ‡ßá‡•§ ‡¶á‡¶Ø‡¶º‡¶æ‡ß∞ ‡¶¶‡ßç‡¶¨‡¶æ‡ß∞‡¶æ ‡¶™‡ßã‡ß±‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ß∞‡¶∏‡¶Æ‡ßÇ‡¶π ‡ßß‡ß¶‡ß¶% ‡¶∂‡ßÅ‡¶¶‡ßç‡¶ß ‡¶®‡¶π\'‡¶¨‡¶ì ‡¶™‡¶æ‡ß∞‡ßá‡•§</p>' }
    };

    function showPage(pageId) {
        document.getElementById('infoTitle').innerHTML = pagesData[pageId].title;
        document.getElementById('infoBody').innerHTML = pagesData[pageId].body;
        document.getElementById('infoModal').style.display = 'flex';
    }

    function closeInfoModal() {
        document.getElementById('infoModal').style.display = 'none';
    }

    async function sendMessage() {
        const inputField = document.getElementById('userInput');
        const message = inputField.value.trim();
        if (!message) return;

        appendMessage('user', message);
        inputField.value = '';
        document.getElementById('sendBtn').disabled = true;
        document.getElementById('typingIndicator').style.display = 'flex';

        try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId: userId, message: message })
            });
            const data = await response.json();
            
            document.getElementById('typingIndicator').style.display = 'none';
            document.getElementById('sendBtn').disabled = false;

            if (data.action_required === "watch_ad") {
                appendMessage('bot', data.response, true);
                document.getElementById('rechargeBtn').style.display = 'block';
            } else {
                appendMessage('bot', data.response);
                if(data.remaining_balance !== undefined) {
                    document.getElementById('tokenDisplay').innerText = `Tokens: ${data.remaining_balance}`;
                }
            }
        } catch (error) {
            document.getElementById('typingIndicator').style.display = 'none';
            document.getElementById('sendBtn').disabled = false;
            appendMessage('bot', "‡¶õ‡¶æ‡ß∞‡ßç‡¶≠‡¶æ‡ß∞‡ß∞ ‡¶∏‡ßà‡¶§‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶®‡¶§ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßà‡¶õ‡ßá‡•§");
        }
    }

async function detectAdBlock() {
    let adTest = document.createElement('div');
    adTest.innerHTML = '&nbsp;';
    adTest.className = 'adsbox ad-placement doubleclick ad-banner'; 
    adTest.style.position = 'absolute';
    adTest.style.top = '-1000px'; 
    document.body.appendChild(adTest);
    
    await new Promise(resolve => setTimeout(resolve, 100)); 
    
    let isAdBlocked = false;
    if (adTest.offsetHeight === 0 || window.getComputedStyle(adTest).display === 'none') {
        isAdBlocked = true;
    }
    adTest.remove(); 
    return isAdBlocked;
}

async function rechargeTokens() {
    document.getElementById('rechargeBtn').innerText = "‡¶™‡ß∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡ß∞‡¶ø ‡¶•‡¶ï‡¶æ ‡¶π‡ßà‡¶õ‡ßá...";
    document.getElementById('rechargeBtn').disabled = true;
    
    let adBlockEnabled = await detectAdBlock();
    
    if (adBlockEnabled) {
        alert("‚ö†Ô∏è ‡¶∏‡¶§‡ß∞‡ßç‡¶ï‡¶¨‡¶æ‡¶£‡ßÄ: ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡ß∞ ‡¶¨‡ßç‡ß∞‡¶æ‡¶â‡¶ú‡¶æ‡ß∞‡¶§ Adblocker ‡¶¨‡¶æ Brave Shield ‡¶Ö‡¶® ‡¶π‡ßà ‡¶Ü‡¶õ‡ßá! ‡¶´‡ßç‡ß∞‡ßÄ ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶™‡¶æ‡¶¨‡¶≤‡ßà ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡ß∞‡¶π ‡¶ï‡ß∞‡¶ø ‡¶á‡¶Ø‡¶º‡¶æ‡¶ï ‡¶¨‡¶®‡ßç‡¶ß (Disable) ‡¶ï‡ß∞‡¶ï‡•§");
        appendMessage('bot', "‚ö†Ô∏è **Adblocker ‡¶ß‡ß∞‡¶æ ‡¶™‡ß∞‡¶ø‡¶õ‡ßá!** ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡ß∞‡¶ø‡¶ö‡¶æ‡ß∞‡ßç‡¶ú ‡¶ï‡ß∞‡¶ø‡¶¨‡¶≤‡ßà ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡ß∞ Brave Shield ‡¶¨‡¶æ Adblocker ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡ß∞‡¶ø ‡¶Ü‡¶ï‡ßå ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡ß∞‡¶ï‡•§");
        document.getElementById('rechargeBtn').innerText = "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶æ‡¶ì‡¶ï (Recharge 500 Coins)";
        document.getElementById('rechargeBtn').disabled = false;
        return; 
    }
    
    document.getElementById('adModal').style.display = 'flex';
    let timeLeft = 10; 
    
    let timerText = document.getElementById('adTimer');
    let closeBtn = document.getElementById('closeAdBtn');
    
    timerText.innerText = `‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡ß∞‡¶π ‡¶ï‡ß∞‡¶ø ${timeLeft} ‡¶õ‡ßá‡¶ï‡ßá‡¶£‡ßç‡¶° ‡ß∞‡ßà ‡¶¶‡¶ø‡¶Ø‡¶º‡¶ï...`;
    timerText.style.color = "red";
    closeBtn.innerText = "‡ß∞‡ßà ‡¶¶‡¶ø‡¶Ø‡¶º‡¶ï...";
    closeBtn.disabled = true;
    closeBtn.style.background = "#ccc";
    closeBtn.style.cursor = "not-allowed";

    let timer = setInterval(() => {
        timeLeft--;
        timerText.innerText = `‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡ß∞‡¶π ‡¶ï‡ß∞‡¶ø ${timeLeft} ‡¶õ‡ßá‡¶ï‡ßá‡¶£‡ßç‡¶° ‡ß∞‡ßà ‡¶¶‡¶ø‡¶Ø‡¶º‡¶ï...`;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            timerText.innerText = "‚úÖ ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Ü‡¶™‡ßã‡¶®‡¶æ‡ß∞ ‡ß∞‡¶ø‡¶ö‡¶æ‡ß∞‡ßç‡¶ú ‡¶∏‡¶æ‡¶ú‡ßÅ‡•§";
            timerText.style.color = "#10a37f";
            
            closeBtn.innerText = "‡ß∞‡¶ø‡¶ö‡¶æ‡ß∞‡ßç‡¶ú ‡¶ï‡ß∞‡¶ï (500 Coins)";
            closeBtn.disabled = false;
            closeBtn.style.background = "#10a37f";
            closeBtn.style.cursor = "pointer";
            
            closeBtn.onclick = async function() {
                document.getElementById('adModal').style.display = 'none'; 
                document.getElementById('rechargeBtn').innerText = "‡ß∞‡ßà ‡¶¶‡¶ø‡¶Ø‡¶º‡¶ï...";
                
                try {
                    const response = await fetch('/api/reward', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ userId: userId, amount: 500 })
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        document.getElementById('tokenDisplay').innerText = `Tokens: ${data.new_balance}`;
                        document.getElementById('rechargeBtn').style.display = 'none';
                        appendMessage('bot', "üéâ ‡ß∞‡¶ø‡¶ö‡¶æ‡ß∞‡ßç‡¶ú ‡¶∏‡¶´‡¶≤ ‡¶π‡ßà‡¶õ‡ßá! ‡¶è‡¶§‡¶ø‡¶Ø‡¶º‡¶æ ‡¶Ü‡¶™‡ßÅ‡¶®‡¶ø ‡¶Ü‡¶ï‡ßå ‡¶™‡ßç‡ß∞‡¶∂‡ßç‡¶® ‡¶∏‡ßÅ‡¶ß‡¶ø‡¶¨ ‡¶™‡¶æ‡ß∞‡¶ø‡¶¨‡•§");
                    }
                } catch (error) {
                    alert("‡ß∞‡¶ø‡¶ö‡¶æ‡ß∞‡ßç‡¶ú ‡¶¨‡¶ø‡¶´‡¶≤ ‡¶π‡ßà‡¶õ‡ßá!");
                }
                document.getElementById('rechargeBtn').innerText = "‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶æ‡¶ì‡¶ï (Recharge 500 Coins)";
                document.getElementById('rechargeBtn').disabled = false;
            }
        }
    }, 1000);
}

    // Markdown ‡¶Ü‡ß∞‡ßÅ ‡¶∏‡¶æ‡¶ß‡¶æ‡ß∞‡¶£ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü‡ß∞ ‡¶¨‡¶æ‡¶¨‡ßá appendMessage ‡¶´‡¶æ‡¶Ç‡¶ö‡¶®‡¶ü‡ßã ‡¶∏‡¶≤‡¶®‡¶ø ‡¶ï‡ß∞‡¶æ ‡¶π‡ßà‡¶õ‡ßá
    function appendMessage(sender, text, isRaw = false) {
        const chatBox = document.getElementById('chatBox');
        const icon = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
        
        let formattedText = text;
        
        // ‡¶Ø‡¶¶‡¶ø ‡¶¨‡ßç‡¶Ø‡ß±‡¶π‡¶æ‡ß∞‡¶ï‡¶æ‡ß∞‡ßÄ‡ß∞ ‡¶Æ‡ßá‡¶õ‡ßá‡¶ú ‡¶π‡¶Ø‡¶º, ‡¶§‡ßá‡¶®‡ßç‡¶§‡ßá ‡¶∏‡¶æ‡¶ß‡¶æ‡ß∞‡¶£‡¶≠‡¶æ‡ß±‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡ß±‡¶æ‡¶¨
        if (sender === 'user') {
            formattedText = text.replace(/\n/g, '<br>');
        } 
        // ‡¶Ø‡¶¶‡¶ø AI ‡ß∞ ‡¶Æ‡ßá‡¶õ‡ßá‡¶ú ‡¶π‡¶Ø‡¶º ‡¶Ü‡ß∞‡ßÅ ‡¶á Raw ‡¶®‡¶π‡¶Ø‡¶º, ‡¶§‡ßá‡¶®‡ßç‡¶§‡ßá Markdown ‡¶π‡¶ø‡¶ö‡¶æ‡¶™‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡ß±‡¶æ‡¶¨
        else if (!isRaw) {
            formattedText = marked.parse(text);
        }

        const msgHTML = `
            <div class="message ${sender}">
                <div class="avatar ${sender}-avatar">${icon}</div>
                <div class="msg-text markdown-body">${formattedText}</div>
            </div>
        `;
        chatBox.innerHTML += msgHTML;
        chatBox.scrollTop = chatBox.scrollHeight;
        
        // ‡¶π‡¶ø‡¶∑‡ßç‡¶ü‡ßç‡ß∞‡ßÄ ‡¶ö‡ßá‡¶≠ ‡¶ï‡ß∞‡¶ï
        saveChatHistory();
    }

    function handleKeyPress(event) {
        if (event.key === "Enter") sendMessage();
    }
</script>
</body>
</html>
